# 3. Глубокое Погружение: Анатомия `manifest.js`

`manifest.js` — это архитектурный чертеж вашего приложения. Это единый, централизованный конфигурационный файл, который декларативно описывает все его составные части: от источников данных до бизнес-логики. Вся мощь Serverokey заключается в структуре этого файла.

Файл `manifest.js` представляет собой стандартный модуль Node.js, который должен экспортировать один единственный JavaScript-объект.

```javascript
// manifest.js

// Здесь вы можете подключать другие JS-файлы, если это необходимо
// const myHelper = require('./app/helpers/myHelper.js');

module.exports = {
  // ... секции конфигурации ...
};
```

## Ключевые Секции Манифеста

Рассмотрим каждую корневую секцию объекта `module.exports` и её предназначение.

---
### 1. `globals`
Секция для определения глобальных переменных, которые будут доступны во всех шаблонах (`.html`) вашего приложения. Это удобный способ хранить статичные данные, такие как название приложения, версия, или любые другие константы, которые используются в UI.

**Пример:**
```javascript
globals: {
  appName: "Атомарная Касса",
  appVersion: "5.0.0",
  companyName: "Serverokey Inc."
}
```
**Доступ в шаблоне:**
```html
<title>{{appName}}</title>
<footer>© {{companyName}}, v{{appVersion}}</footer>
```

---
### 2. `sockets`
Эта секция активирует и настраивает real-time функциональность через WebSocket. Здесь вы описываете "каналы", которые следят за изменениями в ваших данных и отправляют события клиентам.

**Пример:**
```javascript
sockets: {
  "receipt-updates": {
    "watch": "receipt",
    "emit": { "event": "receipt-changed", "payload": "receipt" }
  }
}
```
*Подробно эта мощная функция рассматривается в разделе `07_real_time_with_websockets.md`.*

---
### 3. `auth`
Здесь настраиваются фундаментальные параметры системы аутентификации. Эти настройки сообщают движку, как работать с данными пользователей.

**Пример:**
```javascript
auth: {
  // Имя коннектора, в котором хранятся данные пользователей.
  // Это имя должно точно совпадать с одним из ключей в секции `connectors`.
  userConnector: 'user', 
  
  // Имя поля в объекте пользователя, которое используется как уникальный идентификатор для входа (логин, email и т.д.).
  identityField: 'login',
  
  // Имя поля, в котором хранится хэшированный пароль.
  passwordField: 'passwordHash'
}
```
*Подробно процесс аутентификации описан в разделе `08_auth.md`.*

---
### 4. `connectors`
Это декларация всех источников данных, которые использует ваше приложение. Serverokey абстрагирует способ хранения, позволяя вам сосредоточиться на самих данных.

**Пример:**
```javascript
connectors: {
  receipt: { type: 'wise-json', ... },
  positions: { type: 'wise-json', ... },
  viewState: { type: 'in-memory', ... }
}
```
*Подробно типы коннекторов и работа с ними описаны в разделе `04_connectors.md`.*

---
### 5. `components`
Здесь вы регистрируете все "строительные блоки" вашего пользовательского интерфейса. Каждый компонент — это, как минимум, HTML-шаблон.

**Пример:**
```javascript
components: {
  mainLayout: 'main-layout.html',
  receipt: {
    template: 'receipt.html',
    style: 'receipt.css'
  }
}
```
*Подробно создание компонентов и работа с UI описаны в разделе `05_components_and_ui.md`.*

---
### 6. `routes`
Это самая важная и объемная секция. Она действует как главный маршрутизатор и контроллер вашего приложения. Здесь вы связываете URL-адреса и HTTP-методы с конкретными действиями: либо отображением страницы (`view`), либо выполнением серверной логики (`action`).

**Пример:**
```javascript
routes: {
  // Роут для отображения главной страницы
  'GET /': {
    type: 'view',
    layout: 'mainLayout',
    /* ... */
  },

  // Роут для выполнения действия (добавления товара в чек)
  'POST /action/addItem': {
    type: 'action',
    steps: [ /* ... */ ],
    /* ... */
  },
  
  // Внутренний, переиспользуемый роут
  "recalculateReceiptLogic": {
    type: 'action',
    internal: true,
    steps: [ /* ... */ ]
  }
}
```
*Подробно типы роутов и описание логики через `steps` рассмотрены в разделе `06_actions_and_logic.md`.*

Понимание назначения каждой из этих секций является основой для эффективной разработки на Serverokey. В следующих главах мы детально разберем каждую из них.