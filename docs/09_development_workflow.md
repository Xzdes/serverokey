# 9. –¶–∏–∫–ª –†–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –û—Ç–ª–∞–¥–∫–∞

Serverokey –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏, –∫–æ—Ç–æ—Ä—ã–π –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–æ–≥–æ. –ï–≥–æ —Ü–µ–ª—å ‚Äî –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –∏ —É—Å–∫–æ—Ä–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞, –ø—Ä–µ–≤—Ä–∞—Ç–∏–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É –≤ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–π –∏ —É–ø—Ä–∞–≤–ª—è–µ–º—ã–π –ø—Ä–æ—Ü–µ—Å—Å. –í –æ—Å–Ω–æ–≤–µ —ç—Ç–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –ª–µ–∂–∏—Ç —Ü–∏–∫–ª **"–ú–∞–Ω–∏—Ñ–µ—Å—Ç ‚ûî –í–∞–ª–∏–¥–∞—Ç–æ—Ä ‚ûî –†–µ–∑—É–ª—å—Ç–∞—Ç"**.

## –ó–æ–ª–æ—Ç–æ–µ –ü—Ä–∞–≤–∏–ª–æ: –í–∞–ª–∏–¥–∞—Ç–æ—Ä ‚Äî –í–∞—à –õ—É—á—à–∏–π –î—Ä—É–≥

–ü—Ä–µ–∂–¥–µ —á–µ–º –º—ã —Ä–∞–∑–±–µ—Ä–µ–º —Ü–∏–∫–ª, –∑–∞–ø–æ–º–Ω–∏—Ç–µ –≥–ª–∞–≤–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ —Ä–∞–±–æ—Ç—ã —Å Serverokey: **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ, –ø–æ–∫–∞ –Ω–µ –ø—Ä–æ–≥–Ω–∞–ª–∏ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä –∏ –Ω–µ –ø–æ–ª—É—á–∏–ª–∏ –æ—Ç –Ω–µ–≥–æ "–∑–µ–ª–µ–Ω—ã–π —Å–≤–µ—Ç"**.

–í–∞–ª–∏–¥–∞—Ç–æ—Ä ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ "–ª–∏–Ω—Ç–µ—Ä". –≠—Ç–æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –û–Ω –∑–Ω–∞–µ—Ç –æ —Å–≤—è–∑—è—Ö –º–µ–∂–¥—É —Ä–æ—É—Ç–∞–º–∏, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ –∏ –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–∞–º–∏. –û–Ω –ø–æ–π–º–∞–µ—Ç 90% –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ –∏ –æ–ø–µ—á–∞—Ç–æ–∫ –µ—â–µ –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ –≤—ã –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä. –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —ç—Ç–æ–≥–æ —à–∞–≥–∞ ‚Äî –ø—Ä—è–º–æ–π –ø—É—Ç—å –∫ –¥–æ–ª–≥–æ–π –∏ –º—É—á–∏—Ç–µ–ª—å–Ω–æ–π –æ—Ç–ª–∞–¥–∫–µ.

## –¶–∏–∫–ª –†–∞–∑—Ä–∞–±–æ—Ç–∫–∏ "–ú–∞–Ω–∏—Ñ–µ—Å—Ç ‚ûî –í–∞–ª–∏–¥–∞—Ç–æ—Ä ‚ûî –†–µ–∑—É–ª—å—Ç–∞—Ç"

### –®–∞–≥ 1: –§–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ó–∞–¥–∞—á–∏ –∏ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ú–∞–Ω–∏—Ñ–µ—Å—Ç–∞

–õ—é–±–∞—è –Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä–æ–µ –≤—ã –æ–ø–∏—Å—ã–≤–∞–µ—Ç–µ –≤ `manifest.js`.

**–ü—Ä–∏–º–µ—Ä –∑–∞–¥–∞—á–∏:** "–ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–∏–º–µ–Ω—è—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥ –Ω–∞ 15% —Å–∫–∏–¥–∫–∏".

**–í–∞—à–∏ –º—ã—Å–ª–∏ –∫–∞–∫ –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä–∞ (–∞ –Ω–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–∞):**
1.  –ú–Ω–µ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –Ω–æ–≤—ã–π `action`-—Ä–æ—É—Ç, –Ω–∞–ø—Ä–∏–º–µ—Ä, `POST /action/applyCoupon`.
2.  –≠—Ç–æ—Ç —ç–∫—à–µ–Ω –¥–æ–ª–∂–µ–Ω `—á–∏—Ç–∞—Ç—å` –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–∞ `receipt`.
3.  –û–Ω –¥–æ–ª–∂–µ–Ω `–∑–∞–ø–∏—Å—ã–≤–∞—Ç—å` –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ –≤ `receipt`.
4.  –û–Ω –¥–æ–ª–∂–µ–Ω `–æ–±–Ω–æ–≤–ª—è—Ç—å` –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `receipt` –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ.
5.  –í–Ω—É—Ç—Ä–∏ `steps` –º–Ω–µ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `body.coupon_code` —Ä–∞–≤–µ–Ω "SALE15".
6.  –ï—Å–ª–∏ –¥–∞, —è –∏–∑–º–µ–Ω—é –ø–æ–ª–µ `data.receipt.discountPercent` –Ω–∞ 15.
7.  –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –º–Ω–µ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –∏—Ç–æ–≥–æ–≤—ã–µ —Å—É–º–º—ã, –≤—ã–∑–≤–∞–≤ –º–æ–π –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π —ç–∫—à–µ–Ω `recalculateReceiptLogic`.

–í—ã –æ–ø–∏—Å—ã–≤–∞–µ—Ç–µ —ç—Ç–æ —Ä–µ—à–µ–Ω–∏–µ –≤ `manifest.js` –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é —Ñ–æ—Ä–º—É –≤ `receipt.html`.

### –®–∞–≥ 2: –ó–∞–ø—É—Å–∫ –í–∞–ª–∏–¥–∞—Ç–æ—Ä–∞

–¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ –≤—ã –≤–Ω–µ—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è, **–Ω–µ —Å–ø–µ—à–∏—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä**. –û—Ç–∫—Ä–æ–π—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª –≤ –ø–∞–ø–∫–µ `packages/kassa-app-example` –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É:

```bash
npm run validate
```
–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä–∏—Ç –≤–∞—à–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è.

*   **–ò–¥–µ–∞–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π:** –í—ã –≤–∏–¥–∏—Ç–µ `‚úÖ Manifest validation successful. No issues found.`. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –≤—Å—ë –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ. –ú–æ–∂–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ —à–∞–≥—É 3.

*   **–†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π:** –í—ã –≤–∏–¥–∏—Ç–µ `üö® Found X issues:`. –ù–∞–ø—Ä–∏–º–µ—Ä:
    ```
    1. [ERROR] in Route 'POST /action/applyCoupon'
       Read connector 'reciept' is not defined. Did you mean "receipt"?
    
    2. [ERROR] in Route 'recalculateReceiptLogic'
       Action route is missing 'update' property...
    ```
    **–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
    1.  **–ß–∏—Ç–∞–π—Ç–µ —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑.** –í—Å–µ–≥–¥–∞ –∏—Å–ø—Ä–∞–≤–ª—è–π—Ç–µ —Å–∞–º—É—é –ø–µ—Ä–≤—É—é –æ—à–∏–±–∫—É. –ß–∞—Å—Ç–æ –æ–Ω–∞ —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏—á–∏–Ω–æ–π –≤—Å–µ—Ö –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö.
    2.  **–ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.** –í–∞–ª–∏–¥–∞—Ç–æ—Ä –Ω–µ –ø—Ä–æ—Å—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç "–æ—à–∏–±–∫–∞", –æ–Ω –æ–±—ä—è—Å–Ω—è–µ—Ç, *–ø–æ—á–µ–º—É* —ç—Ç–æ –æ—à–∏–±–∫–∞, –∏ —á–∞—Å—Ç–æ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (`Did you mean...?`). –í –ø—Ä–∏–º–µ—Ä–µ –≤—ã—à–µ, –≤—ã —Å–¥–µ–ª–∞–ª–∏ –æ–ø–µ—á–∞—Ç–∫—É –≤ —Å–ª–æ–≤–µ `receipt`.
    3.  **–ò—Å–ø—Ä–∞–≤—å—Ç–µ –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ.** –í–Ω–µ—Å–∏—Ç–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ `manifest.js`, —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª –∏ —Å–Ω–æ–≤–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ `npm run validate`. –ü–æ–≤—Ç–æ—Ä—è–π—Ç–µ, –ø–æ–∫–∞ –Ω–µ –ø–æ–ª—É—á–∏—Ç–µ –∑–∞–≤–µ—Ç–Ω–æ–µ `‚úÖ`.

### –®–∞–≥ 3: –ó–∞–ø—É—Å–∫ –≤ –†–µ–∂–∏–º–µ –û—Ç–ª–∞–¥–∫–∏ –∏ –ü—Ä–æ–≤–µ—Ä–∫–∞

–¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å —Å–µ—Ä–≤–µ—Ä –∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏:

```bash
npm run dev:debug
```
–≠—Ç–æ—Ç —Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã–≤–æ–¥ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –æ—Ç–ª–∞–¥–∏—Ç—å –ª–æ–≥–∏–∫—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

**–ì–¥–µ –∏—Å–∫–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:**

1.  **–ö–æ–Ω—Å–æ–ª—å —Å–µ—Ä–≤–µ—Ä–∞ (—Ç–µ—Ä–º–∏–Ω–∞–ª):**
    *   –í—ã —É–≤–∏–¥–∏—Ç–µ –ª–æ–≥–∏ –æ—Ç `ActionEngine`, `SocketEngine` –∏ –¥—Ä—É–≥–∏—Ö —á–∞—Å—Ç–µ–π —è–¥—Ä–∞.
    *   –ï—Å–ª–∏ –≤ `steps` –≤–æ–∑–Ω–∏–∫–Ω–µ—Ç –æ—à–∏–±–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–∫–æ—Ç–æ—Ä—É—é –Ω–µ –ø–æ–π–º–∞–ª –≤–∞–ª–∏–¥–∞—Ç–æ—Ä), –≤—ã —É–≤–∏–¥–∏—Ç–µ –∑–¥–µ—Å—å –ø–æ–ª–Ω—ã–π —Å—Ç–µ–∫—Ç—Ä–µ–π—Å.

2.  **–ö–æ–Ω—Å–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ (F12):**
    *   `[Engine] ...`: –õ–æ–≥–∏ –æ—Ç `engine-client.js` –æ WebSocket-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è—Ö –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —ç–∫—à–µ–Ω–æ–≤.
    *   `[DEBUG] Action Triggered: ...`: –†–∞—Å–∫—Ä—ã–≤–∞—é—â–∞—è—Å—è –≥—Ä—É–ø–ø–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ç–æ–º, –∫–∞–∫–æ–π —ç–ª–µ–º–µ–Ω—Ç –≤—ã–∑–≤–∞–ª —ç–∫—à–µ–Ω –∏ –∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ (`body`) –±—ã–ª–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä.
    *   `[DEBUG] Received Payload for: ...`: –†–∞—Å–∫—Ä—ã–≤–∞—é—â–∞—è—Å—è –≥—Ä—É–ø–ø–∞ —Å JSON-–æ—Ç–≤–µ—Ç–æ–º –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞, –≤–∫–ª—é—á–∞—è –Ω–æ–≤—ã–π HTML.

3.  **–ò–Ω—Å–ø–µ–∫—Ç–æ—Ä –≠–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:**
    *   –í —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏ –∫–∞–∂–¥—ã–π –æ—Ç—Ä–µ–Ω–¥–µ—Ä–µ–Ω–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–ª–æ–∫ —Å –ø–æ–ª–Ω—ã–º **–∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –¥–∞–Ω–Ω—ã—Ö** (`data`, `user`, `url`), –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –¥–ª—è –µ–≥–æ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞. –≠—Ç–æ –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω–æ –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ç–æ–≥–æ, –∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–æ—Ö–æ–¥—è—Ç –¥–æ –≤–∞—à–∏—Ö —à–∞–±–ª–æ–Ω–æ–≤.
    ```html
    <div id="receipt-container">
      <!-- [DEBUG] Rendered component 'receipt' with context:
      {
        "data": {
          "receipt": { "items": [], "total": 0, ... }
        },
        "user": { "name": "–ò–≤–∞–Ω–æ–≤ –ò.–ò.", ... }
      }
      -->
      <div data-component-id="c-xxxxxx">...</div>
    </div>
    ```

–°–ª–µ–¥–æ–≤–∞–Ω–∏–µ —ç—Ç–æ–º—É —Ü–∏–∫–ª—É –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ —Ö–∞–æ—Ç–∏—á–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∏ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—É—é –∏–Ω–∂–µ–Ω–µ—Ä–Ω—É—é –ø—Ä–∞–∫—Ç–∏–∫—É.